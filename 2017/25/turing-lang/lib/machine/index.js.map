{"version":3,"sources":["src/machine/index.js"],"names":[],"mappings":"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","file":"src/machine/index.js","sourcesContent":["import Tape from './tape.js';\nimport TransitionFunction, { LEFT, RIGHT, RuleNotFoundException } from './transition-function.js';\nimport { EventEmitter } from 'events';\n\nexport { LEFT, RIGHT } from './transition-function.js';\n\nexport default class TuringMachine extends EventEmitter {\n\tconstructor(initState, haltState){\n\t\tsuper();\n\n\t\tthis.initState = initState;\n\t\tthis.haltState = haltState;\n\n\t\tthis.init();\n\t}\n\n\tinit(){\n\t\t// machine components getting ready\n\t\tthis.tape = new Tape();\n\t\tthis.transitionFunction = new TransitionFunction();\n\n\t\t// machine getting initialized\n\t\tthis.headPosition = 0;\n\t\tthis.currentState = this.initState;\n\t\tthis.running = false;\n\t}\n\n\n\taddRule(state, readSymbol, newState, writtenSymbol, direction){\n\t\tthis.transitionFunction.addRule(state, readSymbol, newState, writtenSymbol, direction);\n\t\tthis.emit(\"ruleAdded\", [state, readSymbol, newState, writtenSymbol, direction]);\n\t}\n\n\tstep() {\n\t\tif (this.running) {\n\t\t\tif (!this.computationEnded()){\n\t\t\t\tlet readSymbol = this.tape.read(this.headPosition);\n\t\t\t\ttry {\n\t\t\t\t\tlet { state, symbol, direction } = this.transition(readSymbol);\n\t\t\t\t\tthis.currentState = state;\n\t\t\t\t\tthis.write(symbol);\n\t\t\t\t\tthis.emit(\"step\", { writtenSymbol: symbol, headPosition: this.headPosition, state });\n\t\t\t\t\t\n\t\t\t\t\tthis.moveHead(direction);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tthis.stop();\n\t\t\t\t\tthis.emit(\"error\", e);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.stop();\n\t\t\t\tthis.emit(\"halt\", this.tape);\n\t\t\t}\n\t\t}\n\n\t}\n\n\trun(transitionTime = 100){\n\t\tthis.running = true;\n\t\tthis.interval_id = setInterval(() => {\n\t\t\tif (this.running) {\n\t\t\t\tthis.step();\n\t\t\t} else {\n\t\t\t\tclearInterval(this.interval_id);\n\t\t\t}\n\t\t}, transitionTime);\n\t}\n\n\tstop(){\n\t\tthis.running = false;\n\t}\n\n\ttransition(readSymbol){\n\t\treturn this.transitionFunction.transition(this.currentState, readSymbol);\n\t}\n\n\tmoveHead(direction){\n\t\tif (direction == LEFT){\n\t\t\tthis.headPosition -= 1;\n\t\t} else {\n\t\t\tthis.headPosition += 1;\n\t\t}\n\t}\n\n\treset(){\n\t\tthis.init();\n\t}\n\n\twrite(symbol){\n\t\tthis.tape.write(this.headPosition, symbol);\n\t}\n\n\tcomputationEnded(){\n\t\treturn this.currentState == this.haltState;\n\t}\n\n\tsurroundingData(size){\n\t\treturn this.tape.readBulk(this.headPosition - size, this.headPosition + size);\n\t}\n}"]}